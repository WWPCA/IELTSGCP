{% extends "layout.html" %}

{% block title %}AI Learning Hub - Mobile API Tester{% endblock %}

{% block head %}
{{ super() }}
<style>
.endpoint-card {
    margin-bottom: 20px;
}
.response-area {
    background-color: #f8f9fa;
    border-radius: 4px;
    padding: 15px;
    font-family: monospace;
    max-height: 300px;
    overflow-y: auto;
}
.response-container {
    display: none;
}
.btn-test {
    margin-top: 10px;
}
.param-input {
    margin-bottom: 10px;
}
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">Mobile API Tester</h1>
            <p class="lead">
                Use this tool to test the AI Learning Hub mobile API endpoints. This is a developer tool for testing and debugging.
            </p>
            
            <div class="alert alert-info">
                <i class="fa fa-info-circle me-2"></i>
                All requests will be made from your browser. Authentication is required for protected endpoints.
            </div>

            <ul class="nav nav-tabs mb-4" id="apiTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="auth-tab" data-bs-toggle="tab" data-bs-target="#auth" type="button" role="tab" aria-controls="auth" aria-selected="true">
                        Authentication
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="courses-tab" data-bs-toggle="tab" data-bs-target="#courses" type="button" role="tab" aria-controls="courses" aria-selected="false">
                        Courses
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="user-tab" data-bs-toggle="tab" data-bs-target="#user" type="button" role="tab" aria-controls="user" aria-selected="false">
                        User Data
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="mobile-tab" data-bs-toggle="tab" data-bs-target="#mobile" type="button" role="tab" aria-controls="mobile" aria-selected="false">
                        Mobile Specific
                    </button>
                </li>
            </ul>

            <div class="tab-content" id="apiTabsContent">
                <!-- Authentication Tab -->
                <div class="tab-pane fade show active" id="auth" role="tabpanel" aria-labelledby="auth-tab">
                    <!-- Login Endpoint -->
                    <div class="card endpoint-card">
                        <div class="card-header">
                            <span class="badge bg-primary me-2">POST</span>
                            <strong>/api/v1/auth/login</strong>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Login</h5>
                            <p class="card-text">Authenticate a user and receive a JWT token.</p>
                            
                            <div class="mb-3">
                                <label for="login-email" class="form-label">Email</label>
                                <input type="email" class="form-control param-input" id="login-email" value="user@example.com">
                            </div>
                            
                            <div class="mb-3">
                                <label for="login-password" class="form-label">Password</label>
                                <input type="password" class="form-control param-input" id="login-password" value="password123">
                            </div>
                            
                            <button class="btn btn-primary btn-test" onclick="testEndpoint('auth/login', 'POST', {
                                email: document.getElementById('login-email').value,
                                password: document.getElementById('login-password').value
                            }, 'login-response')">Test Login</button>
                            
                            <div class="response-container mt-3" id="login-response-container">
                                <h6>Response:</h6>
                                <div class="response-area" id="login-response"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Register Endpoint -->
                    <div class="card endpoint-card">
                        <div class="card-header">
                            <span class="badge bg-primary me-2">POST</span>
                            <strong>/api/v1/auth/register</strong>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Register</h5>
                            <p class="card-text">Register a new user account.</p>
                            
                            <div class="mb-3">
                                <label for="register-username" class="form-label">Username</label>
                                <input type="text" class="form-control param-input" id="register-username" value="newuser">
                            </div>
                            
                            <div class="mb-3">
                                <label for="register-email" class="form-label">Email</label>
                                <input type="email" class="form-control param-input" id="register-email" value="newuser@example.com">
                            </div>
                            
                            <div class="mb-3">
                                <label for="register-password" class="form-label">Password</label>
                                <input type="password" class="form-control param-input" id="register-password" value="newpassword123">
                            </div>
                            
                            <button class="btn btn-primary btn-test" onclick="testEndpoint('auth/register', 'POST', {
                                username: document.getElementById('register-username').value,
                                email: document.getElementById('register-email').value,
                                password: document.getElementById('register-password').value
                            }, 'register-response')">Test Register</button>
                            
                            <div class="response-container mt-3" id="register-response-container">
                                <h6>Response:</h6>
                                <div class="response-area" id="register-response"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Courses Tab -->
                <div class="tab-pane fade" id="courses" role="tabpanel" aria-labelledby="courses-tab">
                    <!-- Get Courses Endpoint -->
                    <div class="card endpoint-card">
                        <div class="card-header">
                            <span class="badge bg-success me-2">GET</span>
                            <strong>/api/v1/courses</strong>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Get All Courses</h5>
                            <p class="card-text">Get a list of all available courses.</p>
                            
                            <button class="btn btn-primary btn-test" onclick="testEndpoint('courses', 'GET', null, 'courses-response')">Test Get Courses</button>
                            
                            <div class="response-container mt-3" id="courses-response-container">
                                <h6>Response:</h6>
                                <div class="response-area" id="courses-response"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Get Course Details Endpoint -->
                    <div class="card endpoint-card">
                        <div class="card-header">
                            <span class="badge bg-success me-2">GET</span>
                            <strong>/api/v1/courses/{course_id}</strong>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Get Course Details</h5>
                            <p class="card-text">Get detailed information about a specific course.</p>
                            
                            <div class="mb-3">
                                <label for="course-id" class="form-label">Course ID</label>
                                <input type="number" class="form-control param-input" id="course-id" value="1">
                            </div>
                            
                            <button class="btn btn-primary btn-test" onclick="testEndpoint(`courses/${document.getElementById('course-id').value}`, 'GET', null, 'course-details-response')">Test Get Course Details</button>
                            
                            <div class="response-container mt-3" id="course-details-response-container">
                                <h6>Response:</h6>
                                <div class="response-area" id="course-details-response"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- User Data Tab -->
                <div class="tab-pane fade" id="user" role="tabpanel" aria-labelledby="user-tab">
                    <!-- Authentication Token -->
                    <div class="card mb-4">
                        <div class="card-header bg-warning text-dark">
                            <strong>Authentication Required</strong>
                        </div>
                        <div class="card-body">
                            <p class="card-text">These endpoints require authentication. Please enter your JWT token.</p>
                            
                            <div class="mb-3">
                                <label for="auth-token" class="form-label">JWT Token</label>
                                <input type="text" class="form-control" id="auth-token">
                            </div>
                            
                            <div class="form-text text-muted">
                                You can get a token by using the Login endpoint in the Authentication tab.
                            </div>
                        </div>
                    </div>
                    
                    <!-- Get User Profile Endpoint -->
                    <div class="card endpoint-card">
                        <div class="card-header">
                            <span class="badge bg-success me-2">GET</span>
                            <strong>/api/v1/user/profile</strong>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Get User Profile</h5>
                            <p class="card-text">Get the current user's profile information.</p>
                            
                            <button class="btn btn-primary btn-test" onclick="testEndpoint('user/profile', 'GET', null, 'user-profile-response', true)">Test Get User Profile</button>
                            
                            <div class="response-container mt-3" id="user-profile-response-container">
                                <h6>Response:</h6>
                                <div class="response-area" id="user-profile-response"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Get User Progress Endpoint -->
                    <div class="card endpoint-card">
                        <div class="card-header">
                            <span class="badge bg-success me-2">GET</span>
                            <strong>/api/v1/user/progress</strong>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Get User Progress</h5>
                            <p class="card-text">Get the current user's learning progress.</p>
                            
                            <button class="btn btn-primary btn-test" onclick="testEndpoint('user/progress', 'GET', null, 'user-progress-response', true)">Test Get User Progress</button>
                            
                            <div class="response-container mt-3" id="user-progress-response-container">
                                <h6>Response:</h6>
                                <div class="response-area" id="user-progress-response"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Mobile Specific Tab -->
                <div class="tab-pane fade" id="mobile" role="tabpanel" aria-labelledby="mobile-tab">
                    <!-- Sync Data Endpoint -->
                    <div class="card endpoint-card">
                        <div class="card-header">
                            <span class="badge bg-primary me-2">POST</span>
                            <strong>/api/v1/sync</strong>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Sync Data</h5>
                            <p class="card-text">Synchronize local data with the server.</p>
                            
                            <div class="mb-3">
                                <label for="sync-device-id" class="form-label">Device ID</label>
                                <input type="text" class="form-control param-input" id="sync-device-id" value="550e8400-e29b-41d4-a716-446655440000">
                            </div>
                            
                            <div class="mb-3">
                                <label for="sync-type" class="form-label">Sync Type</label>
                                <select class="form-control param-input" id="sync-type">
                                    <option value="full">Full</option>
                                    <option value="partial" selected>Partial</option>
                                    <option value="content">Content</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="sync-content-type" class="form-label">Content Type</label>
                                <select class="form-control param-input" id="sync-content-type">
                                    <option value="course" selected>Course</option>
                                    <option value="lesson">Lesson</option>
                                    <option value="note">Note</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-primary btn-test" onclick="testEndpoint('sync', 'POST', {
                                device_id: document.getElementById('sync-device-id').value,
                                sync_type: document.getElementById('sync-type').value,
                                content_type: document.getElementById('sync-content-type').value,
                                local_changes: []
                            }, 'sync-response', true)">Test Sync</button>
                            
                            <div class="response-container mt-3" id="sync-response-container">
                                <h6>Response:</h6>
                                <div class="response-area" id="sync-response"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Get App Configuration Endpoint -->
                    <div class="card endpoint-card">
                        <div class="card-header">
                            <span class="badge bg-success me-2">GET</span>
                            <strong>/api/v1/config</strong>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Get App Configuration</h5>
                            <p class="card-text">Get configuration information for the mobile app.</p>
                            
                            <div class="mb-3">
                                <label for="platform-header" class="form-label">Platform (X-Platform header)</label>
                                <select class="form-control param-input" id="platform-header">
                                    <option value="ios" selected>iOS</option>
                                    <option value="android">Android</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-primary btn-test" onclick="testEndpoint('config', 'GET', null, 'config-response', false, {
                                'X-Platform': document.getElementById('platform-header').value,
                                'X-App-Version': '1.0.0',
                                'X-Device-Model': 'Test Device',
                                'X-OS-Version': '15.0'
                            })">Test Get Config</button>
                            
                            <div class="response-container mt-3" id="config-response-container">
                                <h6>Response:</h6>
                                <div class="response-area" id="config-response"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function testEndpoint(endpoint, method, data, responseId, requiresAuth = false, extraHeaders = {}) {
        const responseArea = document.getElementById(responseId);
        const responseContainer = document.getElementById(responseId + '-container');
        responseContainer.style.display = 'block';
        responseArea.innerHTML = 'Loading...';
        
        const url = `/api/v1/${endpoint}`;
        const headers = {
            'Content-Type': 'application/json',
            ...extraHeaders
        };
        
        if (requiresAuth) {
            const token = document.getElementById('auth-token').value;
            if (!token) {
                responseArea.innerHTML = 'Error: Authentication token is required for this endpoint.';
                return;
            }
            headers['Authorization'] = `Bearer ${token}`;
        }
        
        const options = {
            method,
            headers,
            credentials: 'same-origin'
        };
        
        if (data && method !== 'GET') {
            options.body = JSON.stringify(data);
        }
        
        fetch(url, options)
            .then(response => response.json())
            .then(data => {
                responseArea.innerHTML = JSON.stringify(data, null, 2);
                
                // If this is a login response with a token, auto-fill the token field
                if (endpoint === 'auth/login' && data.success && data.data && data.data.token) {
                    document.getElementById('auth-token').value = data.data.token;
                }
            })
            .catch(error => {
                responseArea.innerHTML = `Error: ${error.message}`;
            });
    }
</script>
{% endblock %}