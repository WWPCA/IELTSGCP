{% extends "layout.html" %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8 text-center">
            <div class="card">
                <div class="card-body">
                    <div class="mb-4">
                        <i class="fas fa-check-circle text-success fa-5x"></i>
                    </div>
                    
                    <h1 class="mb-4">Payment Successful!</h1>
                    
                    <p class="lead mb-4">Thank you for purchasing IELTS AI Prep tests.</p>
                    
                    {% if current_user.is_authenticated and current_user.subscription_expiry %}
                        <div class="alert alert-success">
                            <h3 class="h5">Plan Details</h3>
                            {% for entry in current_user.test_history %}
                                {% if entry.subscription_data %}
                                    <p><strong>Plan:</strong> {{ entry.subscription_data.plan.capitalize() }}</p>
                                    <p><strong>Tests Available:</strong> {{ entry.subscription_data.tests_remaining }} / {{ entry.subscription_data.total_tests }}</p>
                                    <p><strong>Access Until:</strong> {{ current_user.subscription_expiry.strftime('%B %d, %Y') }}</p>
                                    <p class="mt-2 small">
                                        {% if "pro" in entry.subscription_data.plan or "value_pack" in entry.subscription_data.plan %}
                                            Value Pack subscriptions provide access for 30 days.
                                        {% else %}
                                            Single and Double test packages provide access for 15 days.
                                        {% endif %}
                                    </p>
                                    {% endif %}
                                {% elif entry.test_purchase %}
                                    <p><strong>Test Type:</strong> {{ entry.test_purchase.test_type.capitalize() }}</p>
                                    <p><strong>Package:</strong> {{ entry.test_purchase.plan.split('_')[1]|replace('_', ' ')|capitalize }}</p>
                                    <p><strong>Tests Available:</strong> {{ entry.test_purchase.tests_remaining }} / {{ entry.test_purchase.total_tests }}</p>
                                    <p><strong>Access Until:</strong> {{ datetime.fromisoformat(entry.test_purchase.expiry_date).strftime('%B %d, %Y') }}</p>
                                    <p class="mt-2 small">
                                        {% if "value_pack" in entry.test_purchase.plan %}
                                            Value Pack subscriptions provide access for 30 days.
                                        {% else %}
                                            Single and Double test packages provide access for 15 days.
                                        {% endif %}
                                    </p>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    <div class="mt-4">
                        <h3>What's Next?</h3>
                        <p>You now have full access to all features in your plan:</p>
                        <ul class="list-group mb-4">
                            <li class="list-group-item">
                                <i class="fas fa-book me-2 text-primary"></i> Access to Reading Tests
                            </li>
                            <li class="list-group-item">
                                <i class="fas fa-microphone-alt me-2 text-primary"></i> AI-Powered Speaking Assessments
                            </li>
                            <li class="list-group-item">
                                <i class="fas fa-chart-line me-2 text-primary"></i> Performance Analytics
                            </li>
                            <li class="list-group-item">
                                <i class="fas fa-wifi-slash me-2 text-primary"></i> Offline Mode Access
                            </li>
                        </ul>
                    </div>
                    
                    <div class="alert alert-info">
                        <p class="mb-0">A confirmation email has been sent to your registered email address.</p>
                    </div>
                    
                    <div class="mt-4">
                        <a href="{{ url_for('practice_index') }}" class="btn btn-primary me-3">
                            <i class="fas fa-book me-2"></i> Start Practicing
                        </a>
                        <a href="{{ url_for('profile') }}" class="btn btn-outline-primary">
                            <i class="fas fa-user me-2"></i> Go to My Profile
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="mt-5">
                <h3>Ready to Start?</h3>
                <p>You can begin your IELTS preparation immediately with your new subscription.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
