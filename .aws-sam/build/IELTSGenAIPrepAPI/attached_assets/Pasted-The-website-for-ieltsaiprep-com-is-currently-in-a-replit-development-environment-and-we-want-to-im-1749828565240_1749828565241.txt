The website for ieltsaiprep.com is currently in a .replit development environment, and we want to implement the QR code authentication changes before deploying it to AWS. Please make the following updates in the .replit environment first, so we can test everything before the AWS deployment. This builds on the current AWS architecture (Lambda, DynamoDB, ElastiCache, API Gateway) and the existing website:

Set Up Website Access Restriction for ieltsaiprep.com:
Modify the existing ieltsaiprep.com website in the .replit environment to display a login screen with a QR code scanner. Restrict access so users can’t view assessments unless authenticated, returning a “Please authenticate via the app” message if no valid session is detected.
Implement QR Code Authentication:
In the Capacitor mobile app, after a successful in-app purchase (verified via Apple App Store Connect API /verifyReceipt or Google Play Billing API purchases.products.get), generate a unique QR code with a one-time token (e.g., using uuid.uuid4()).
Update the Lambda backend to include an API endpoint (e.g., /auth/verify-qr) that the .replit ieltsaiprep.com website calls. When the QR code is scanned, the website sends the token to this endpoint, which checks a local DynamoDB mock (or test table) for a valid, unexpired token and matching user_id. If valid, create a session in a local ElastiCache mock (or test instance) (e.g., redis_client.set(f'session:{user_id}', 'active', ex=3600)) and grant web access.
Update Mobile App:
Modify the Capacitor app to display the QR code after purchase via the Toast plugin or a custom screen, with instructions to scan it on the .replit ieltsaiprep.com.
Ensure the app calls the Lambda backend to confirm the purchase and generate the token.
Update Lambda Backend:
Add a new API route in the Lambda function (e.g., @app.route('/auth/verify-qr', methods=['POST'])) to handle QR code verification for the .replit ieltsaiprep.com. Validate the token against a test DynamoDB table and set a session key in a test ElastiCache instance.
Ensure the backend only allows assessment access (e.g., /assessment/<user_id>) if a valid session exists, serving data for the .replit environment.
Update Website Frontend for ieltsaiprep.com:
Integrate a QR code scanning library (e.g., html5-qrcode) into the existing .replit ieltsaiprep.com login page. On scan, send the token to the /auth/verify-qr endpoint and, if successful, load the assessment page.
Fetch assessments from the Lambda backend (e.g., /assessment/<user_id>) and display them, pulling only written data from the test DynamoDB.
Environment Settings:
In Replit’s Secrets tab, use test AWS credentials or local mocks for DynamoDB and ElastiCache endpoints to simulate the production environment.
Test Everything in .replit:
Test the flow in the .replit environment: Simulate an in-app purchase, generate a QR code, scan it on ieltsaiprep.com, and verify access to assessments. Use Replit’s live reload and log to CloudWatch (or a local log) to check for errors or delays.
Security:
Ensure tokens expire quickly (e.g., 10 minutes) and are single-use. Implement logic to handle token expiration in the Lambda backend for the test setup.
Once these changes are tested and working in the .replit environment, let me know, and I’ll handle the AWS deployment. If you run into issues, please reach out for help!